<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Admin — Desafio 40+</title>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
  <style>
    body{background:#001a35;color:#fff;font-family:sans-serif;margin:0;padding:30px;}
    h2{color:#ffd700;}
    #erros{background:#330000;color:#ffcfcf;padding:10px;margin:15px 0;border-radius:10px;}
    #sucesso{background:#002d00;color:#a8e6a6;padding:10px;margin:15px 0;border-radius:10px;}
    #alunas{background:#112244;padding:10px;border-radius:8px;}
    .aluna-item{margin-bottom:10px;padding:8px;border-radius:6px;background:#233f5a;display:flex;align-items:center;justify-content:space-between;}
    .aluna-nome{font-weight:700;}
    .pontos{margin:0 10px;}
    .edit-pontos{width:50px;}
    button{padding:8px 16px;border-radius:8px;border:none;background:#2a6af7;color:#fff;}
    .remover-btn{background:#c83d3d;margin-left:10px;}
    .salvar-btn{background:#16a34a;margin-left:10px;}
    input{padding:8px;border-radius:8px;}
    #treinoBox{background:#112244;padding:14px;border-radius:10px;margin-bottom:24px;}
    #statusTreino{margin-top:8px;color:#ffd700;}
  </style>
</head>
<body>
  <h2>Admin — Desafio 40+</h2>
  <div id="erros"></div>
  <div id="sucesso"></div>

  <!-- Bloco do código do treino do dia -->
  <div id="treinoBox">
    <h3>Código do treino do dia</h3>
    <input id="codigoTreino" placeholder="Digite o código do treino" />
    <button onclick="salvarCodigoTreino()" style="background:#16a34a;">Salvar</button>
    <div id="statusTreino"></div>
  </div>

  <!-- Bloco de adicionar aluna -->
  <div>
    <h3>Adicionar aluna</h3>
    <input id="nomeAluna" placeholder="Nome da aluna" />
    <button onclick="addAluna()">Adicionar</button>
  </div>

  <!-- Lista de alunas -->
  <div>
    <h3>Lista de alunas</h3>
    <div id="alunas">Carregando...</div>
  </div>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyAMf0Z5_a1DufNRCTHGPGC6ZBE9T2-tYAU",
      authDomain: "clube-aguiar-live.firebaseapp.com",
      projectId: "clube-aguiar-live",
      storageBucket: "clube-aguiar-live.firebasestorage.app",
      messagingSenderId: "694025911850",
      appId: "1:694025911850:web:5f0c6117dbc60b15118d53"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    function logErro(msg) {
      document.getElementById("erros").textContent = msg;
      setTimeout(()=>{document.getElementById("erros").textContent = "";}, 5000);
    }
    function logSucesso(msg) {
      document.getElementById("sucesso").textContent = msg;
      setTimeout(()=>{document.getElementById("sucesso").textContent = "";}, 3000);
    }

    // --------- CÓDIGO DO TREINO DO DIA --------------

    async function salvarCodigoTreino() {
      const codigo = document.getElementById("codigoTreino").value.trim();
      if (!codigo) {
        document.getElementById("statusTreino").textContent = "Digite o código!";
        return;
      }
      document.getElementById("statusTreino").textContent = "Salvando...";
      try {
        await db.collection("config").doc("treino_do_dia").set({ codigo });
        document.getElementById("statusTreino").textContent = "Código salvo com sucesso!";
        setTimeout(() => { document.getElementById("statusTreino").textContent = ""; }, 2500);
        document.getElementById("codigoTreino").value = "";
      } catch(e) {
        document.getElementById("statusTreino").textContent = "Erro ao salvar: " + e.message;
      }
    }

    // --------- ALUNAS --------------

    async function carregarAlunas() {
      try {
        const snap = await db.collection("usuarios").orderBy("nome").get();
        const lista = document.getElementById("alunas");
        if (snap.empty) {
          lista.innerHTML = "Nenhuma aluna cadastrada.";
          return;
        }
        let html = "";
        snap.forEach(doc => {
          const d = doc.data();
          html += `
            <div class="aluna-item" id="item-${doc.id}">
              <span class="aluna-nome">${d.nome}</span>
              <span class="pontos">${d.pontos ?? 0} pts</span>
              <input type="number" class="edit-pontos" id="edit-${doc.id}" placeholder="+/- po" />
              <button class="salvar-btn" onclick="editarPontos('${doc.id}', ${d.pontos ?? 0})">Salvar</button>
              <button class="remover-btn" onclick="removerAluna('${doc.id}')">Remover</button>
            </div>
          `;
        });
        lista.innerHTML = html;
      } catch(e) {
        logErro("ERRO ao carregar alunas: " + e.message);
      }
    }
    carregarAlunas();

    async function addAluna() {
      const nome = document.getElementById("nomeAluna").value.trim();
      if (!nome) return;
      try {
        await db.collection("usuarios").add({ nome, pontos: 0 });
        logSucesso("Aluna adicionada!");
        document.getElementById("nomeAluna").value = "";
        carregarAlunas();
      } catch(e) {
        logErro("ERRO ao adicionar aluna: " + e.message);
      }
    }

    async function editarPontos(id, pontosAtuais) {
      const val = parseInt(document.getElementById("edit-" + id).value);
      if (isNaN(val)) {
        logErro("Insira um número para editar pontos.");
        return;
      }
      try {
        await db.collection("usuarios").doc(id).update({ pontos: pontosAtuais + val });
        logSucesso("Pontuação atualizada!");
        carregarAlunas();
      } catch(e) {
        logErro("ERRO ao editar pontos: " + e.message);
      }
    }

    async function removerAluna(id) {
      if(!confirm("Tem certeza que deseja remover esta aluna?")) return;
      try {
        await db.collection("usuarios").doc(id).delete();
        logSucesso("Aluna removida!");
        carregarAlunas();
      } catch(e) {
        logErro("ERRO ao remover aluna: " + e.message);
      }
    }
  </script>
</body>
</html>
