<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Admin — Desafio 40+</title>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@600;800&display=swap" rel="stylesheet">
  <style>
    body{background:#061b30;color:#e6efff;font-family:Poppins,Arial,sans-serif;margin:0;}
    .container{max-width:750px;margin:40px auto;padding:0 16px;}
    h2{color:#ffd700;font-weight:800;}
    #erros{background:#330000;color:#ffcfcf;padding:10px;margin:15px 0;border-radius:10px;}
    #sucesso{background:#002d00;color:#a8e6a6;padding:10px;margin:15px 0;border-radius:10px;}
    .card{background:rgba(255,255,255,0.06);border-radius:14px;padding:22px;margin-bottom:26px;box-shadow:0 6px 16px rgba(0,0,0,.13);}
    .card h3{color:#fff;margin-top:0;}
    input,button{font-family:Poppins,Arial,sans-serif;}
    input{padding:12px;border-radius:12px;border:1px solid #2947ad;background:#0d2144;color:#e6efff;font-size:15px;}
    button{padding:11px 18px;border-radius:12px;border:none;background:linear-gradient(180deg,#3d66ff,#224ad6);color:#fff;font-weight:700;font-size:15px;cursor:pointer;margin-left:8px;}
    button:hover{opacity:.93;}
    .salvar-btn{background:#16a34a;}
    .remover-btn{background:#c83d3d;}
    .remover-btn:hover{background:#8c2020;}
    .tab-bar{display:flex;gap:10px;margin-bottom:16px;}
    .tab-btn{background:#2947ad;color:#fff;font-weight:600;padding:10px 22px;border-radius:10px;cursor:pointer;border:none;}
    .tab-btn.active{background:#ffd700;color:#2947ad;}
    .alunas-list{margin-top:14px;}
    .aluna-card{background:#132a4b;border-radius:14px;box-shadow:0 2px 10px rgba(0,0,0,.09);padding:18px;margin-bottom:18px;}
    .aluna-nome{font-weight:700;font-size:17px;color:#fff;}
    .pontos{font-size:15px;color:#a8e6a6;}
    .edit-pontos{width:65px;padding:8px;}
    .selo-list{display:flex;gap:12px;flex-wrap:wrap;margin:12px 0;}
    .selo{padding:8px 18px;border-radius:18px;font-weight:700;font-size:14px;display:inline-block;cursor:pointer;transition:0.2s;}
    .selo.ouro{background:linear-gradient(90deg,#ffe066,#ffd700);color:#735f00;}
    .selo.prata{background:linear-gradient(90deg,#e0e0e0,#b0b0b0);color:#444;}
    .selo.destaque{background:linear-gradient(90deg,#e0aaff,#7209b7);color:#fff;}
    .selo.selecionado{border:2px solid #2947ad;box-shadow:0 0 8px #ffd700;}
    .selo-remove{padding:4px 11px;margin-left:6px;border-radius:14px;background:#c83d3d;color:#fff;font-weight:600;font-size:12px;cursor:pointer;}
    @media(max-width:600px){
      .container{padding:0 4px;}
      .card{padding:12px;}
      .aluna-card{padding:12px;}
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>Admin — Desafio 40+</h2>
    <div id="erros"></div>
    <div id="sucesso"></div>

    <!-- Código do treino do dia -->
    <div class="card">
      <h3>Código do treino do dia</h3>
      <input id="codigoTreino" placeholder="Digite o código do treino" />
      <button onclick="salvarCodigoTreino()" class="salvar-btn">Salvar</button>
      <div id="statusTreino" style="margin-top:8px;color:#ffd700;"></div>
    </div>

    <!-- Adicionar aluna -->
    <div class="card">
      <h3>Adicionar aluna</h3>
      <input id="nomeAluna" placeholder="Nome da aluna" />
      <button onclick="addAluna()">Adicionar</button>
    </div>

    <!-- Tabs de Pontuação/Selos -->
    <div class="tab-bar">
      <button class="tab-btn active" id="tabPontuacao" onclick="mudarAba('pontuacao')">Pontuação</button>
      <button class="tab-btn" id="tabSelos" onclick="mudarAba('selos')">Selos</button>
    </div>

    <!-- Lista de alunas -->
    <div id="alunasList" class="alunas-list"></div>
  </div>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyAMf0Z5_a1DufNRCTHGPGC6ZBE9T2-tYAU",
      authDomain: "clube-aguiar-live.firebaseapp.com",
      projectId: "clube-aguiar-live",
      storageBucket: "clube-aguiar-live.firebasestorage.app",
      messagingSenderId: "694025911850",
      appId: "1:694025911850:web:5f0c6117dbc60b15118d53"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    function logErro(msg) {
      document.getElementById("erros").textContent = msg;
      setTimeout(()=>{document.getElementById("erros").textContent = "";}, 5000);
    }
    function logSucesso(msg) {
      document.getElementById("sucesso").textContent = msg;
      setTimeout(()=>{document.getElementById("sucesso").textContent = "";}, 3000);
    }

    // --------- CÓDIGO DO TREINO DO DIA --------------
    async function salvarCodigoTreino() {
      const codigo = document.getElementById("codigoTreino").value.trim();
      if (!codigo) {
        document.getElementById("statusTreino").textContent = "Digite o código!";
        return;
      }
      document.getElementById("statusTreino").textContent = "Salvando...";
      try {
        await db.collection("config").doc("treino_do_dia").set({ codigo });
        document.getElementById("statusTreino").textContent = "Código salvo com sucesso!";
        setTimeout(() => { document.getElementById("statusTreino").textContent = ""; }, 2500);
        document.getElementById("codigoTreino").value = "";
      } catch(e) {
        document.getElementById("statusTreino").textContent = "Erro ao salvar: " + e.message;
      }
    }

    // --------- TABS -----------------
    let ABA = 'pontuacao';
    function mudarAba(aba) {
      ABA = aba;
      document.getElementById('tabPontuacao').classList.toggle('active', aba === 'pontuacao');
      document.getElementById('tabSelos').classList.toggle('active', aba === 'selos');
      carregarAlunas();
    }

    // --------- ALUNAS E SELOS -------------

    const SEL0S = [
      { nome: "Ouro", class:"ouro"},
      { nome: "Prata", class:"prata"},
      { nome: "Destaque", class:"destaque"},
    ];

    async function carregarAlunas() {
      try {
        const snap = await db.collection("usuarios").orderBy("nome").get();
        const lista = document.getElementById("alunasList");
        if (snap.empty) {
          lista.innerHTML = "<div style='padding:12px;'>Nenhuma aluna cadastrada.</div>";
          return;
        }
        let html = "";
        snap.forEach(doc => {
          const d = doc.data();
          html += `<div class="aluna-card" id="item-${doc.id}">`;
          html += `<div class="aluna-nome">${d.nome}</div>`;
          if(ABA === 'pontuacao') {
            html += `
              <div style="display:flex;align-items:center;gap:9px;margin-top:8px;">
                <span class="pontos">${d.pontos ?? 0} pts</span>
                <input type="number" class="edit-pontos" id="edit-${doc.id}" placeholder="+/- po" />
                <button class="salvar-btn" onclick="editarPontos('${doc.id}', ${d.pontos ?? 0})">Salvar</button>
                <button class="remover-btn" onclick="removerAluna('${doc.id}')">Remover</button>
              </div>
            `;
          } else if (ABA === 'selos') {
            const selos = Array.isArray(d.selos) ? d.selos : [];
            html += `<div class="selo-list">`;
            SEL0S.forEach(selo => {
              const isSel = selos.includes(selo.nome);
              html += `<span class="selo ${selo.class}${isSel ? " selecionado":""}" onclick="alternarSelo('${doc.id}','${selo.nome}')">${selo.nome}</span>`;
            });
            html += `</div>`;
            html += `<div style="font-size:13px;color:#888;">Clique para adicionar/remover selos</div>`;
          }
          html += `</div>`;
        });
        lista.innerHTML = html;
      } catch(e) {
        logErro("ERRO ao carregar alunas: " + e.message);
      }
    }
    carregarAlunas();

    async function addAluna() {
      const nome = document.getElementById("nomeAluna").value.trim();
      if (!nome) return;
      try {
        await db.collection("usuarios").add({ nome, pontos: 0, selos: [] });
        logSucesso("Aluna adicionada!");
        document.getElementById("nomeAluna").value = "";
        carregarAlunas();
      } catch(e) {
        logErro("ERRO ao adicionar aluna: " + e.message);
      }
    }

    async function editarPontos(id, pontosAtuais) {
      const val = parseInt(document.getElementById("edit-" + id).value);
      if (isNaN(val)) {
        logErro("Insira um número para editar pontos.");
        return;
      }
      try {
        await db.collection("usuarios").doc(id).update({ pontos: pontosAtuais + val });
        logSucesso("Pontuação atualizada!");
        carregarAlunas();
      } catch(e) {
        logErro("ERRO ao editar pontos: " + e.message);
      }
    }

    async function removerAluna(id) {
      if(!confirm("Tem certeza que deseja remover esta aluna?")) return;
      try {
        await db.collection("usuarios").doc(id).delete();
        logSucesso("Aluna removida!");
        carregarAlunas();
      } catch(e) {
        logErro("ERRO ao remover aluna: " + e.message);
      }
    }

    // ADICIONAR/REMOVER SELOS
    async function alternarSelo(id, seloNome) {
      try {
        const ref = db.collection("usuarios").doc(id);
        const doc = await ref.get();
        const selos = Array.isArray(doc.data().selos) ? doc.data().selos : [];
        let novoSelos = [];
        if(selos.includes(seloNome)){
          novoSelos = selos.filter(s => s !== seloNome); // remove
        } else {
          novoSelos = [...selos, seloNome]; // adiciona
        }
        await ref.update({ selos: novoSelos });
        logSucesso("Selos atualizados!");
        carregarAlunas();
      } catch(e) {
        logErro("Erro ao atualizar selos: " + e.message);
      }
    }

  </script>
</body>
</html>
