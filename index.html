<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Ranking Desafio 40+</title>
  <style>
    body{font-family:Arial,Helvetica,sans-serif;background:#f2f6fa;margin:0;padding:0}
    header{padding:18px;text-align:center;background:#fff;box-shadow:0 2px 8px rgba(0,0,0,.06);margin-bottom:16px}
    h1{margin:0}
    .wrap{max-width:1000px;margin:0 auto;padding:0 12px 24px}
    table{width:100%;border-collapse:collapse;background:#fff;border:1px solid #e5e7eb}
    th,td{padding:10px;border:1px solid #e5e7eb;text-align:left}
    th{background:#111827;color:#fff}
    .avatar{width:36px;height:36px;border-radius:50%;object-fit:cover;background:#e5e7eb;display:inline-block}
    .pos{width:36px;text-align:center}
  </style>
</head>
<body>
  <header><h1>Ranking Desafio 40+</h1></header>
  <div class="wrap">
    <table>
      <thead>
        <tr>
          <th class="pos">#</th>
          <th>Foto</th>
          <th>Nome</th>
          <th>Pontos</th>
          <th>Status</th>
          <th>Selos</th>
          <th>ðŸ“ˆ</th>
        </tr>
      </thead>
      <tbody id="tbody"></tbody>
    </table>
    <p id="stamp" style="color:#6b7280;font-size:12px;margin-top:8px"></p>
  </div>

  <!-- Firebase compat -->
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>

  <script>
    // Config (seus dados)
    const firebaseConfig = {
      apiKey: "AIzaSyAMf0Z5_a1DufNRCTHGPGC6ZBE9T2-tYAU",
      authDomain: "clube-aguiar-live.firebaseapp.com",
      projectId: "clube-aguiar-live",
      storageBucket: "clube-aguiar-live.firebasestorage.app",
      messagingSenderId: "694025911850",
      appId: "1:694025911850:web:5f0c6117dbc60b15118d53"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    const tbody = document.getElementById('tbody');
    const stamp = document.getElementById('stamp');

    // LÃª 'meta/ranking' para mostrar a Ãºltima publicaÃ§Ã£o
    db.collection('meta').doc('ranking').onSnapshot(doc=>{
      const d = doc.data();
      if(d?.lastPublished?.toDate){
        const dt = d.lastPublished.toDate();
        stamp.textContent = 'Ãšltima publicaÃ§Ã£o do ranking: ' +
          dt.toLocaleString('pt-BR', { dateStyle:'short', timeStyle:'short' });
      } else {
        stamp.textContent = 'Ranking ainda nÃ£o publicado (ðŸ“ˆ sem referÃªncia).';
      }
    });

    // LÃª players em tempo real, ordenados por pontos
    db.collection('players').orderBy('points','desc').onSnapshot(snap=>{
      const arr = snap.docs.map(d=>({ id:d.id, ...d.data() }));
      tbody.innerHTML = '';
      arr.forEach((p, idx)=>{
        const posAtual = idx+1;
        const posPublic = p.position || null;
        let varTxt = 'â€”';
        if(posPublic){
          if(posAtual < posPublic) varTxt = 'â†‘';
          else if(posAtual > posPublic) varTxt = 'â†“';
        }
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td class="pos">${posAtual}</td>
          <td>${p.photoUrl ? `<img class="avatar" src="${p.photoUrl}" alt="${p.name}">` : `<div class="avatar"></div>`}</td>
          <td>${p.name||''}</td>
          <td>${p.points||0}</td>
          <td>${p.status||''}</td>
          <td>${(p.badges||[]).join(' ')}</td>
          <td>${varTxt}</td>
        `;
        tbody.appendChild(tr);
      });
    });
  </script>
</body>
</html>
