<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ranking Desafio 40+</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg-1:#0b1e33; --bg-2:#0f2745; --card:#0f2b52; --stroke:#29486d;
      --text:#e6f0ff; --muted:#a9c5ff; --brand:#3b82f6; --brand-2:#6aa6ff;
      --ok:#22c55e; --warn:#f59e0b; --err:#ef4444;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family:Poppins,system-ui,-apple-system,Segoe UI,Roboto,Arial;
      color:var(--text); background:radial-gradient(1200px 600px at 70% -10%, #16345c 0%, #0b1e33 60%, #081628 100%);
    }
    .wrap{max-width:1080px; margin:56px auto; padding:0 20px}
    header{
      display:flex; align-items:center; justify-content:space-between; margin-bottom:20px;
    }
    .brand{display:flex; align-items:center; gap:14px}
    .brand img{height:36px; width:auto; display:block}
    .brand h1{margin:0; font-size:32px; font-weight:700; letter-spacing:.2px}
    .cta{background:linear-gradient(180deg,var(--brand),var(--brand-2));
      color:#fff; border:0; padding:12px 18px; border-radius:12px; font-weight:600; cursor:pointer}
    .card{
      background:linear-gradient(180deg,rgba(255,255,255,.02),rgba(255,255,255,.01));
      border:1px solid var(--stroke); border-radius:18px; box-shadow:0 20px 40px rgba(0,0,0,.35);
    }
    .hero{padding:26px}
    .hero h2{margin:0 0 6px; font-size:30px; font-weight:700}
    .hero p{margin:0; color:var(--muted)}
    /* Podium */
    .podium{display:grid; grid-template-columns:1fr 1fr 1fr; gap:16px; margin-top:18px}
    .pod{background:var(--card); border:1px solid var(--stroke); border-radius:16px; padding:14px}
    .pod .top{display:flex; align-items:center; gap:12px; margin-bottom:10px}
    .circle{height:40px; width:40px; border-radius:50%; display:grid; place-items:center;
      font-weight:700; color:#0d2240; background:#dbe9ff; border:2px solid #9cc0ff}
    .pod h4{margin:0; font-size:16px}
    .pod small{color:var(--muted)}
    .medal{margin-left:auto; font-size:20px}
    .preview{height:80px; border-radius:10px; background:rgba(255,255,255,.05); border:1px dashed var(--stroke)}
    /* Table */
    table{width:100%; border-collapse:collapse; overflow:hidden; border-radius:16px; margin-top:18px}
    thead th{background:var(--card); border-bottom:1px solid var(--stroke); text-align:left; padding:14px; font-weight:600}
    tbody td{border-bottom:1px solid rgba(255,255,255,.06); padding:14px}
    tbody tr:nth-child(odd){background:rgba(255,255,255,.02)}
    .cell-circle{display:flex; align-items:center; gap:12px}
    .badges span{margin-right:6px}
    .muted{color:var(--muted)}
    .error{color:var(--err); padding:18px}
    @media (max-width:820px){ .podium{grid-template-columns:1fr; } }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="brand">
        <!-- Coloque seu arquivo /images/logo-aguiar.png na mesma pasta do index ou ajuste o src -->
        <img src="images/logo-aguiar.png" alt="Clube Aguiar" onerror="this.style.display='none'">
        <h1>Ranking Desafio 40+</h1>
      </div>
      <a class="cta" href="checkin.html">Fazer check-in →</a>
    </header>

    <section class="card hero">
      <h2>Ranking Desafio 40+</h2>
      <p>Acompanhe a classificação das atletas. Pontos atualizados automaticamente.</p>

      <div id="podium" class="podium" aria-live="polite"></div>

      <table class="card">
        <thead>
          <tr>
            <th style="width:60px">#</th>
            <th style="width:120px">Foto</th>
            <th>Nome</th>
            <th style="width:120px">Pontos</th>
            <th style="width:220px">Status</th>
            <th style="width:160px">Selos</th>
          </tr>
        </thead>
        <tbody id="tbody">
          <tr><td colspan="6" class="muted" id="loading">Carregando…</td></tr>
        </tbody>
      </table>
      <div id="err" class="error" hidden></div>
    </section>
  </div>

  <!-- Firebase (modular) -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-app.js";
    import {
      getFirestore, collection, query, orderBy, onSnapshot
    } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-firestore.js";

    // === SEU FIREBASE (o mesmo que já estava funcionando) ===
    const firebaseConfig = {
      apiKey: "AIzaSyAMf0Z5_a1DufNRCTHGPGC6ZBE9T2-tYAU",
      authDomain: "clube-aguiar-live.firebaseapp.com",
      projectId: "clube-aguiar-live",
      storageBucket: "clube-aguiar-live.appspot.com",
      messagingSenderId: "694025911850",
      appId: "1:694025911850:web:5f0c6117dbc60b15118d53"
    };

    const app = initializeApp(firebaseConfig);
    const db  = getFirestore(app);

    const $tbody   = document.getElementById('tbody');
    const $podium  = document.getElementById('podium');
    const $err     = document.getElementById('err');
    const $loading = document.getElementById('loading');

    const initials = (name="") => name.trim().split(/\s+/).slice(0,2).map(p=>p[0]?.toUpperCase()||"").join("");

    function renderPodium(players){
      $podium.innerHTML = '';
      const medals = ['🏆','🥈','🥉'];
      players.slice(0,3).forEach((p,i) => {
        const div = document.createElement('div');
        div.className = 'pod';
        div.innerHTML = `
          <div class="top">
            <div class="circle">${initials(p.name)}</div>
            <div>
              <h4>${i+1}º — ${p.name || ''}</h4>
              <small>${p.points ?? 0} pts</small>
            </div>
            <div class="medal">${medals[i]||''}</div>
          </div>
          <div class="preview"></div>
        `;
        $podium.appendChild(div);
      });
    }

    function renderTable(players){
      if(!players.length){
        $tbody.innerHTML = `<tr><td class="muted" colspan="6">Sem atletas no ranking.</td></tr>`;
        return;
      }
      $tbody.innerHTML = players.map((p,idx)=>{
        const badgeHtml = (p.badges||[]).map(b=>`<span>${b}</span>`).join('');
        return `
          <tr>
            <td>${idx+1}</td>
            <td>
              <div class="cell-circle">
                <div class="circle">${initials(p.name)}</div>
              </div>
            </td>
            <td>${p.name||''}</td>
            <td><strong>${p.points ?? 0}</strong></td>
            <td class="muted">${p.status||'—'}</td>
            <td class="badges">${badgeHtml||'—'}</td>
          </tr>
        `;
      }).join('');
    }

    // Live query do ranking
    const q = query(collection(db,'ranking'), orderBy('points','desc'), orderBy('name','asc'));
    onSnapshot(q, {
      next:(snap)=>{
        $err.hidden = true;
        const players = snap.docs.map(d=>({id:d.id, ...d.data()}));
        renderPodium(players);
        renderTable(players);
      },
      error:(e)=>{
        console.error(e);
        $err.textContent = 'Erro ao carregar ranking.';
        $err.hidden = false;
        $tbody.innerHTML = `<tr><td colspan="6" class="error">Erro ao carregar ranking.</td></tr>`;
      }
    });
  </script>
</body>
</html>
