<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <title>Ranking Desafio 40+</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    :root{--bg:#0b1b2b;--panel:#12263a;--line:#18354f;--txt:#e8f1fb;--muted:#9bb5cf;--accent:#6aa5ff}
    *{box-sizing:border-box} body{margin:0;background:var(--bg);color:var(--txt);font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu}
    .wrap{max-width:980px;margin:40px auto;padding:0 16px}
    .head{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px}
    .btn{background:var(--accent);color:#061525;border:0;padding:12px 16px;border-radius:12px;font-weight:700;text-decoration:none}
    .card{background:var(--panel);border:1px solid var(--line);border-radius:16px;box-shadow:0 6px 20px rgba(0,0,0,.2)}
    h1{font-size:32px;margin:0 0 8px}
    h2{font-size:22px;margin:0;padding:20px}
    table{width:100%;border-collapse:collapse}
    thead th{background:#0f2032;padding:14px;border-bottom:1px solid var(--line);text-align:left}
    tbody td{padding:12px;border-bottom:1px solid var(--line)}
    .foto{width:40px;height:40px;border-radius:50%;object-fit:cover;border:1px solid var(--line)}
    .muted{color:var(--muted)}
    .center{display:flex;justify-content:center;align-items:center}
    .err{color:#ff6b6b;font-weight:700;padding:12px}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="head">
      <h1>Ranking Desafio 40+</h1>
      <a class="btn" href="checkin.html">Fazer check-in →</a>
    </div>

    <div class="card">
      <h2>Ranking Desafio 40+</h2>
      <div id="erro" class="err" style="display:none"></div>
      <div style="padding:0 20px 20px">
        <table>
          <thead>
            <tr>
              <th>#</th>
              <th>Foto</th>
              <th>Nome</th>
              <th>Pontos</th>
              <th>Status</th>
              <th>Selos</th>
            </tr>
          </thead>
          <tbody id="tbody">
            <tr><td colspan="6" class="muted center">Carregando…</td></tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- Firebase + Ranking -->
  <script type="module">
    // ======== CONFIGURE AQUI O SEU PROJETO FIREBASE ========
    const firebaseConfig = {
      apiKey: "COLE_SUA_API_KEY_AQUI",
      authDomain: "SEU_PROJETO.firebaseapp.com",
      projectId: "SEU_PROJETO",
      storageBucket: "SEU_PROJETO.appspot.com",
      messagingSenderId: "XXXXXXXXXXXX",
      appId: "1:XXXXXXXXXXXX:web:XXXXXXXXXXXXXX"
    };
    // =======================================================

    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import {
      getFirestore, collection, query, orderBy, onSnapshot, limit
    } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    const app = initializeApp(firebaseConfig);
    const db  = getFirestore(app);

    const tbody = document.getElementById('tbody');
    const erro  = document.getElementById('erro');

    function render(rows){
      if(!rows.length){
        tbody.innerHTML = `<tr><td colspan="6" class="muted center">Sem atletas cadastradas.</td></tr>`;
        return;
      }
      tbody.innerHTML = rows.map((a,idx)=>`
        <tr>
          <td>${idx+1}</td>
          <td>${a.photo ? `<img class="foto" src="${a.photo}" alt="">` : '-'}</td>
          <td>${a.name ?? ''}</td>
          <td>${a.points ?? 0}</td>
          <td>${a.status ?? ''}</td>
          <td>${Array.isArray(a.badges)? a.badges.join(' ') : ''}</td>
        </tr>
      `).join('');
    }

    try{
      const q = query(collection(db,'athletes'), orderBy('points','desc'), limit(100));
      onSnapshot(q, (snap)=>{
        const rows = [];
        snap.forEach(doc=>rows.push(doc.data()));
        render(rows);
      }, (err)=>{
        erro.style.display='block';
        erro.textContent = 'Erro ao carregar ranking.';
      });
    }catch(e){
      erro.style.display='block';
      erro.textContent = 'Erro ao carregar ranking.';
    }
  </script>
</body>
</html>
