<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Ranking das atletas do Desafio 40+ Play</title>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@700;900&display=swap" rel="stylesheet">
  <style>
    /* ... mant√©m todos os estilos anteriores ... */
    .top-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      max-width: 900px;
      margin: 0 auto;
      padding: 30px 35px 0 35px;
      gap: 18px;
    }
    .checkin-label {
      color: #fffde5;
      font-weight: 700;
      font-size: 1.06rem;
      margin-right: 18px;
      background: rgba(0,0,0,0.09);
      padding: 8px 16px;
      border-radius: 13px;
    }
    .checkin-box {
      display: flex;
      gap: 12px;
      align-items: center;
    }
    .checkin-select {
      border-radius: 11px;
      padding: 8px 16px;
      font-size: 1.09rem;
      font-family: Poppins, Arial, sans-serif;
      background: #143869;
      color: #fffde5;
      border: none;
      font-weight: 700;
      box-shadow: 0 2px 8px #0003;
    }
    .checkin-input {
      border-radius: 11px;
      padding: 8px 16px;
      font-size: 1.09rem;
      font-family: Poppins, Arial, sans-serif;
      background: #143869;
      color: #fffde5;
      border: none;
      font-weight: 700;
      box-shadow: 0 2px 8px #0003;
      width: 120px;
    }
    .checkin-btn {
      background: linear-gradient(180deg,#ffd700,#e3c300);
      color: #143869;
      font-weight: 900;
      font-size: 1.13rem;
      border: none;
      border-radius: 13px;
      padding: 12px 36px;
      cursor: pointer;
      letter-spacing: 1px;
      box-shadow: 0 2px 12px #0002;
      transition: background .2s;
    }
    .checkin-btn:hover { background: linear-gradient(180deg,#e3c300,#ffd700);}
    .confetti {
      position: fixed;
      top: 0; left: 0; width: 100vw; height: 100vh;
      pointer-events: none;
      z-index: 9999;
      animation: fadeout 2.5s forwards;
    }
    @keyframes fadeout { 100% { opacity: 0; } }
    .checkin-success {
      margin-top: 24px;
      background: linear-gradient(90deg, #ffd700 0%, #ffe066 100%);
      color: #143869;
      font-weight: 900;
      font-size: 1.33rem;
      border-radius: 20px;
      padding: 24px 14px;
      box-shadow: 0 2px 18px #0003;
      text-align: center;
      max-width: 500px;
      margin-left: auto;
      margin-right: auto;
      letter-spacing: 1px;
    }
    .checkin-motivation {
      margin-top: 12px;
      font-size: 1.18rem;
      color: #183a73;
      font-weight: 700;
      margin-bottom: 0;
    }
    /* ... mant√©m todos os estilos anteriores ... */
  </style>
</head>
<body>
  <div class="top-bar">
    <input class="search-box" placeholder="Search" id="searchInput" oninput="filtrarRanking()"/>
    <div class="checkin-box">
      <span class="checkin-label">Fez seu treino? Confirme aqui agora mesmo:</span>
      <select class="checkin-select" id="checkinSelect">
        <option value="" disabled selected>Selecione seu nome</option>
      </select>
      <input class="checkin-input" id="checkinCode" placeholder="C√≥digo treino"/>
      <button class="checkin-btn" onclick="doCheckin()">CHECK-IN</button>
    </div>
  </div>
  <div id="checkinResult"></div>
  <div class="ranking-box">
    <div class="header">
      <h1>RANKING DAS ATLETAS DO<br>DESAFIO 40+ PLAY</h1>
      <div class="subtitle">
        Ranking oficial das mulheres que inspiram e transformam esfor√ßo em resultados.
      </div>
    </div>
    <div class="podium-row" id="podiumRow"></div>
    <div class="ranking-list-box">
      <ul class="ranking-list" id="rankingList"></ul>
    </div>
  </div>
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyAMf0Z5_a1DufNRCTHGPGC6ZBE9T2-tYAU",
      authDomain: "clube-aguiar-live.firebaseapp.com",
      projectId: "clube-aguiar-live",
      storageBucket: "clube-aguiar-live.firebasestorage.app",
      messagingSenderId: "694025911850",
      appId: "1:694025911850:web:5f0c6117dbc60b15118d53"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // --- Check-in ---
    let todasAlunas = [];
    let checkinCodeOficial = "404play"; // pode ser alterado depois

    function normalizarCodigo(str){
      return str
        .toLowerCase()
        .normalize('NFD').replace(/[\u0300-\u036f]/g, '') // remove acentos
        .replace(/√ß/g,'c')
        .replace(/[^a-z0-9]/g,''); // remove s√≠mbolos
    }

    function preencherSelect(){
      const select = document.getElementById("checkinSelect");
      select.innerHTML = '<option value="" disabled selected>Selecione seu nome</option>';
      todasAlunas.forEach(a=>{
        select.innerHTML += `<option value="${a.nome}">${a.nome}</option>`;
      });
    }

    async function doCheckin(){
      const nome = document.getElementById("checkinSelect").value;
      const code = document.getElementById("checkinCode").value;
      if(!nome){
        alert("Selecione seu nome.");
        return;
      }
      if(!code){
        alert("Digite o c√≥digo do treino.");
        return;
      }
      if(normalizarCodigo(code) !== normalizarCodigo(checkinCodeOficial)){
        alert("C√≥digo do treino inv√°lido!");
        return;
      }
      // Atualiza Firestore +5 pontos
      const snap = await db.collection("usuarios").where("nome","==",nome).get();
      if(snap.empty){
        alert("Nome n√£o encontrado.");
        return;
      }
      const doc = snap.docs[0];
      const pontosAtuais = doc.data().pontos ?? 0;
      await db.collection("usuarios").doc(doc.id).update({pontos: pontosAtuais+5});
      showCheckinSuccess(nome);
      renderRanking();
    }

    function showCheckinSuccess(nome){
      const motivacoes = [
        "Parab√©ns! Voc√™ est√° evoluindo a cada treino!",
        "Treino confirmado! Voc√™ est√° inspirando outras mulheres!",
        "Mandou bem demais, continue nessa energia!",
        "Mais 5 pontos pra conta! Voc√™ √© exemplo de dedica√ß√£o!",
        "Sua for√ßa est√° transformando resultados! Continue!"
      ];
      const msg = motivacoes[Math.floor(Math.random()*motivacoes.length)];
      document.getElementById("checkinResult").innerHTML = `
        <div class="checkin-success">
          üéâ Parab√©ns, ${nome}! Voc√™ ganhou 5 pontos.
          <div class="checkin-motivation">${msg}</div>
        </div>
      `;
      confetti();
      setTimeout(()=>document.getElementById("checkinResult").innerHTML="", 4000);
    }

    // Confetti animation
    function confetti(){
      const colors=["#ffd700","#7209b7","#38b4ff","#ff4d6d","#b0b0b0"];
      const confettiDiv = document.createElement("div");
      confettiDiv.className = "confetti";
      for(let i=0;i<60;i++){
        const span = document.createElement("span");
        const size = Math.random()*11+8;
        span.style.position="absolute";
        span.style.width=size+"px";
        span.style.height=size+"px";
        span.style.background=colors[Math.floor(Math.random()*colors.length)];
        span.style.borderRadius="50%";
        span.style.left=Math.random()*100+"vw";
        span.style.top=Math.random()*80+"vh";
        span.style.opacity=Math.random()*0.6+0.4;
        span.style.transform=`rotate(${Math.random()*360}deg)`;
        confettiDiv.appendChild(span);
      }
      document.body.appendChild(confettiDiv);
      setTimeout(()=>confettiDiv.remove(), 2300);
    }

    // Ranking render
    async function renderRanking() {
      const snap = await db.collection("usuarios").orderBy("pontos","desc").get();
      todasAlunas = [];
      snap.forEach(doc => {
        const d = doc.data();
        todasAlunas.push({
          nome: d.nome,
          pontos: d.pontos ?? 0,
          selos: Array.isArray(d.selos) ? d.selos : []
        });
      });
      preencherSelect();
      desenharRanking(todasAlunas);
    }

    function desenharRanking(alunas){
      // PODIUM
      let podiumHtml = "";
      const medalInfos = [
        {label:"Ouro", cls:"ouro", base:"ouro"},
        {label:"Prata", cls:"prata", base:"prata"},
        {label:"Bronze", cls:"bronze", base:"bronze"}
      ];
      for(let i=0;i<3;i++){
        const a = alunas[i];
        if(!a) continue;
        podiumHtml += `
          <div class="podium-card ${medalInfos[i].cls}">
            <span class="podium-selo ${medalInfos[i].cls}">${medalInfos[i].label}</span>
            <div class="podium-nome">${a.nome}</div>
            <div class="podium-pontos">${a.pontos} pts</div>
            <div class="podium-base ${medalInfos[i].base}"></div>
          </div>
        `;
      }
      document.getElementById("podiumRow").innerHTML = podiumHtml;

      // LISTA COMPLETA
      let listHtml = "";
      for(let i=3;i<alunas.length;i++){
        const a = alunas[i];
        listHtml += `
          <li class="ranking-list-item">
            <span class="pos-ball">${i+1}</span>
            <span class="ranking-list-nome">${a.nome}</span>
            <span class="ranking-list-pontos">${a.pontos} pts</span>
            <span class="ranking-list-selos">
              ${a.selos.map(s=>`<span class="ranking-list-selo ${seloClass(s)}">${s}</span>`).join('')}
            </span>
          </li>
        `;
      }
      document.getElementById("rankingList").innerHTML = listHtml;
    }

    function filtrarRanking(){
      const termo = document.getElementById("searchInput").value.toLowerCase().trim();
      if(!termo) { desenharRanking(todasAlunas); return;}
      const filtradas = todasAlunas.filter(a => a.nome.toLowerCase().includes(termo));
      desenharRanking(filtradas);
    }

    renderRanking();
  </script>
</body>
</html>
